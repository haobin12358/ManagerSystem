webpackJsonp([25],{"1yQP":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),i=a.n(s),r=a("XiPb"),o=a("QGdL"),n=a("mYEk"),l=a("P9l9"),c=a("mtWM"),u=a.n(c),p={data:function(){return{title_list:[{name:"店铺活动",url:"/activity/storeActivity"},{name:"创建/编辑活动",url:"/activity/activityStoreStepThree"}],step:[{name:"基本信息",active:!0,next:!0},{name:"优惠门槛及内容",active:!0,next:!0},{name:"设置商品优惠",active:!0,next:!1}],storeForm:{name:"",status:""},rules:{ACbrand:[{required:!0,message:"请选择优惠类型",trigger:"blur"}]},radio:"1",product_data:[],page_data:{total_page:0,current_page:1,total_num:0,page_size:10},check_data:[]}},components:{pageTitle:r.a,step:o.a,Pagination:n.a},mounted:function(){var t=this.$store.state.activity;return t.COname&&t.COabo&&t.COstart&&t.COend?t.COfilter&&(t.COdiscount||t.COamount||"其它"==t.COtype)?void this.getData():(this.$message({type:"warning",message:"请先填写第二步内容",duration:1e3}),this.$router.push("/activity/activityStoreStepTwo"),!1):(this.$message({type:"warning",message:"请先填写第一步内容",duration:1e3}),this.$router.push("/activity/activityStoreStepOne"),!1)},methods:{getData:function(t,e){var a=this,s=this,i={token:localStorage.getItem("token"),PBstatus:this.storeForm.status,page_num:t||this.page_data.current_page,page_size:this.page_data.page_size,product_filter:e||""};u.a.get(l.a.get_all_product,{params:i}).then(function(t){if(200==t.data.status){a.product_data=t.data.data.products;for(var e=function(t){-1!=a.$store.state.activity.PRids.indexOf(a.product_data[t].PRid)&&s.$nextTick(function(){s.$refs.table.toggleRowSelection(s.product_data[t],!0)})},i=0;i<a.product_data.length;i++)e(i);a.page_data.total_num=t.data.data.count,a.page_data.total_page=Math.ceil(a.page_data.total_num/a.page_data.page_size)}else a.$message.error(t.data.message)},function(t){a.$message.error(t.data.message)})},freshClick:function(){console.log("fresh")},onSubmit:function(){this.getData(1,this.storeForm.name)},changeFun:function(t){for(var e=[],a=0;a<t.length;a++)e.push(t[a].PRid);this.check_data[this.page_data.current_page-1]=[].concat(e);for(var s=[],r=JSON.parse(i()(this.check_data)),o=0;o<r.length;o++)s=s.concat(r[o]);this.$store.state.activity.PRids=[].concat(s)},storeSubmit:function(){var t=this;if(this.$route.query.COid)return this.$message({type:"warning",message:"已创建过的活动不可修改"}),!1;var e=JSON.parse(i()(this.$store.state.activity));"其它"==e.COtype&&(e.COother=0==e.COotherType&&""==e.COotherContent[0]?"包邮":e.COotherContent[e.COotherType]),e.COamount=Number(e.COamount),e.COnumber=Number(e.COnumber),e.COfilter=Number(e.COfilter),e.COdiscount=Number(e.COdiscount),u.a.post(l.a.create+"?token="+localStorage.getItem("token"),e).then(function(e){200==e.data.status?(t.$message({type:"success",message:"处理成功 "}),t.$store.state.activity={COabo:"",COname:"",COstatus:"",COstart:"",COend:"",COfilter:null,COother:"",COdiscount:null,COamount:null,COtype:"满减",COunit:"元",COnumber:null,COimage:[],COotherType:"0",COotherContent:["","",""],COproduct:"全店商品",PRids:[],COgenre:"活动"},t.$router.push("/activity/storeActivity")):t.$message({type:"error",message:"服务器请求失败，请稍后再试 "})},function(e){t.$message({type:"error",message:"服务器请求失败，请稍后再试 "})})},lastStep:function(){this.$router.push("/activity/activityStoreStepTwo")},pageChange:function(t){if(t==this.page_data.current_page)return this.$message({message:"这已经是第"+t+"页数据了",type:"warning"}),!1;this.page_data.current_page=t,this.getData(t)}},created:function(){}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"m-step"},[a("page-title",{attrs:{list:t.title_list},on:{freshClick:t.freshClick}}),t._v(" "),a("el-form",{ref:"storeForm",staticClass:"demo-ruleForm",attrs:{model:t.$store.state.activity,rules:t.rules,"label-width":"1.2rem",disabled:t.$store.state.activity.disabled}},[a("div",{staticClass:"m-step-content"},[a("h3",{staticClass:"m-step-title"},[t._v("创建新活动")]),t._v(" "),a("div",{staticClass:"m-step-part"},[a("step",{attrs:{list:t.step}})],1),t._v(" "),a("div",{staticClass:"m-step-part"},[a("h3",{staticClass:"m-step-h3 m-flex-between"},[a("span",[t._v("活动名称："+t._s(t.$store.state.activity.COname))])]),t._v(" "),a("div",[a("table",{staticClass:"m-activity-table",attrs:{width:"100%"}},[a("tr",[a("td",{attrs:{width:"250"}},[t._v("活动描述："),a("span",[t._v(t._s(t.$store.state.activity.COabo))])]),t._v(" "),a("td",[t._v("活动时间："),a("span",[t._v(t._s(t.$store.state.activity.COstart)+" 至 "+t._s(t.$store.state.activity.COend))])]),t._v(" "),a("td",{attrs:{width:"320"}},[t._v("活动预热："),a("span",[t._v("预热")])])]),t._v(" "),a("tr",[a("td",[t._v("活动类型："),a("span",[t._v(t._s(t.$store.state.activity.COtype))])])])])])]),t._v(" "),a("el-form-item",{attrs:{label:"优惠类型：",prop:"ACbrand"}},[a("p",[a("el-radio",{attrs:{label:"自选商品"},model:{value:t.$store.state.activity.COproduct,callback:function(e){t.$set(t.$store.state.activity,"COproduct",e)},expression:"$store.state.activity.COproduct"}},[t._v("自选商品")])],1),t._v(" "),a("p",[a("el-radio",{attrs:{label:"全店商品"},model:{value:t.$store.state.activity.COproduct,callback:function(e){t.$set(t.$store.state.activity,"COproduct",e)},expression:"$store.state.activity.COproduct"}},[t._v("全店商品")])],1)]),t._v(" "),"自选商品"==t.$store.state.activity.COproduct?a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.storeForm}},[a("div",{staticClass:"m-select-box"},[a("div",{staticClass:"m-left"},[a("el-form-item",{attrs:{label:"商品名称"}},[a("el-input",{staticClass:"m-input-s",attrs:{placeholder:""},model:{value:t.storeForm.name,callback:function(e){t.$set(t.storeForm,"name",e)},expression:"storeForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"商品状态"}},[a("el-select",{staticClass:"m-input-s",attrs:{placeholder:""},model:{value:t.storeForm.status,callback:function(e){t.$set(t.storeForm,"status",e)},expression:"storeForm.status"}},[a("el-option",{attrs:{label:"全部",value:""}}),t._v(" "),a("el-option",{attrs:{label:"上架状态",value:"上架状态"}}),t._v(" "),a("el-option",{attrs:{label:"下架状态",value:"下架状态"}}),t._v(" "),a("el-option",{attrs:{label:"预售中",value:"预售中"}})],1)],1)],1),t._v(" "),a("div",{staticClass:"m-right"},[a("el-form-item",[a("el-button",{staticClass:"m-select-btn",attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("搜索")])],1)],1)])]):t._e(),t._v(" "),"自选商品"==t.$store.state.activity.COproduct?a("div",{staticClass:"m-middle",staticStyle:{width:"100%","margin-top":"0.1rem"}},[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:t.product_data,stripe:""},on:{"selection-change":t.changeFun}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"userId",width:"400",label:"宝贝描述"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"m-production-description"},[a("img",{staticClass:"m-img",staticStyle:{width:"0.6rem",height:"0.6rem"},attrs:{src:e.row.PRimage[0]}}),t._v(" "),a("div",[a("p",[t._v(t._s(e.row.PRname))]),t._v(" "),a("p",[t._v(t._s(e.row.PRid))])])])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"userId",label:"价格"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"PRstatus",label:"状态"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"PRstock",label:"库存"}})],1)],1):t._e(),t._v(" "),"自选商品"==t.$store.state.activity.COproduct?a("div",{staticClass:"m-page-box"},[a("pagination",{attrs:{total:t.page_data.total_page},on:{pageChange:t.pageChange}})],1):t._e(),t._v(" "),a("div",{staticClass:"m-bottom-btn m-flex-center"},[a("span",{staticClass:"m-btn",on:{click:t.lastStep}},[t._v("上一步")]),t._v(" "),a("span",{staticClass:"m-btn  active",on:{click:t.storeSubmit}},[t._v("完成")])])],1)])],1)},staticRenderFns:[]};var d=a("VU/8")(p,m,!1,function(t){a("R4V9")},"data-v-175af030",null);e.default=d.exports},R4V9:function(t,e){}});
//# sourceMappingURL=25.d19bdf051f35141a46de.js.map