webpackJsonp([22],{EqxO:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),r=a.n(s),i=a("XiPb"),n=a("QGdL"),o=a("mYEk"),l=a("mtWM"),d=a.n(l),c=a("P9l9"),u={data:function(){return{title_list:[{name:"优惠券",url:"/activity/discountCoupon"},{name:"添加商品优惠券",url:"/activity/discountProductStepOne"}],step:[{name:"添加优惠券",active:!0,next:!1},{name:"完成",active:!1,next:!1}],storeForm:{name:""},rules:{COname:[{required:!0,message:"请输入活动名称",trigger:"blur"}],COamount:[{required:!0,message:"请输入优惠金额",trigger:"blur"}],COstart:[{required:!0,message:"请选择开始时间",trigger:"blur"}],COend:[{required:!0,message:"请选择结束时间",trigger:"blur"}],COfilter:[{required:!0,message:"请输入使用门槛",trigger:"blur"}],COnumber:[{required:!0,message:"请输入发行量",trigger:"blur"}],COuserfilter:[{required:!0,message:"请输入每人限额",trigger:"blur"}]},show_modal:!1,product_data:[],page_data:{total_page:0,current_page:1,total_num:0,page_size:1},check_data:[]}},components:{pageTitle:i.a,step:n.a,Pagination:o.a},mounted:function(){this.getData(),this.$route.query.COid&&this.getDetailData(this.$route.query.COid)},methods:{getDetailData:function(t){var e=this;d.a.get(c.a.get_acabo,{params:{token:localStorage.getItem("token"),COid:t}}).then(function(t){200==t.data.status&&(e.$store.state.discount={COabo:t.data.data.COabo,COname:t.data.data.COname,COstatus:t.data.data.COstatus,COstart:t.data.data.COstart,COend:t.data.data.COend,COfilter:t.data.data.COfilter,COother:t.data.data.COother,COdiscount:t.data.data.COdiscount,COamount:t.data.data.COamount,COtype:t.data.data.COtype,COunit:t.data.data.COunit,COnumber:t.data.data.COnumber,PRids:t.data.data.PRids,COuserfilter:t.data.data.COuserfilter,COgenre:"优惠券",disable:!0})})},getData:function(t,e){var a=this,s=this,r={token:localStorage.getItem("token"),page_num:t||this.page_data.current_page,page_size:this.page_data.page_size,product_filter:e};d.a.get(c.a.get_all_product,{params:r}).then(function(t){if(200==t.data.status){a.product_data=t.data.data.products;for(var e=function(t){-1!=a.$store.state.discount.PRids.indexOf(a.product_data[t].PRid)&&s.$nextTick(function(){s.$refs.table.toggleRowSelection(s.product_data[t],!0)})},r=0;r<a.product_data.length;r++)e(r);a.page_data.total_num=t.data.data.count,a.page_data.total_page=Math.ceil(a.page_data.total_num/a.page_data.page_size)}else a.$message.error(t.data.message)},function(t){a.$message.error(t.data.message)})},onSubmit:function(){this.show_modal=!1},showModal:function(t){this.show_modal=t},storeSubmit:function(){this.getData(1,this.storeForm.name)},changeFun:function(t){for(var e=[],a=0;a<t.length;a++)e.push(t[a].PRid);this.check_data[this.page_data.current_page-1]=[].concat(e);for(var s=[],i=JSON.parse(r()(this.check_data)),n=0;n<i.length;n++)s=s.concat(i[n]);this.$store.state.discount.PRids=[].concat(s)},createOne:function(){var t=this;if(this.$route.query.COid)return this.$message({type:"warning",message:"已创建过的优惠券不可修改"}),!1;this.$refs.storeForm.validate(function(e){if(e){var a=JSON.parse(r()(t.$store.state.discount));a.COamount=Number(a.COamount),a.COnumber=Number(a.COnumber),a.COfilter=Number(a.COfilter),a.COdiscount=Number(a.COdiscount),a.COuserfilter=Number(a.COuserfilter),d.a.post(c.a.create+"?token="+localStorage.getItem("token"),a).then(function(e){200==e.data.status?(t.$message({type:"success",message:"处理成功 "}),t.$store.state.discount={COabo:"",COname:"",COstatus:"",COstart:"",COend:"",COfilter:null,COother:"",COdiscount:null,COamount:null,COtype:"",COnumber:null,PRids:[],COuserfilter:null,COgenre:"优惠券"},"activity"==t.$route.query.router?t.$router.push("/activity/activityStoreStepTwo?COid="+e.data.data):t.$router.push({path:"/activity/storeStepResult",query:{COamount:a.COamount,COfilter:a.COfilter,COstart:a.COstart,COend:a.COend}})):t.$message({type:"error",message:"服务器请求失败，请稍后再试 "})},function(e){t.$message({type:"error",message:"服务器请求失败，请稍后再试 "})})}})},pageChange:function(t){if(t==this.page_data.current_page)return this.$message({message:"这已经是第"+t+"页数据了",type:"warning"}),!1;this.page_data.current_page=t,this.getData(t)}},created:function(){}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"m-step"},[a("page-title",{attrs:{list:t.title_list}}),t._v(" "),a("el-form",{ref:"storeForm",staticClass:"demo-ruleForm",attrs:{model:t.$store.state.discount,rules:t.rules,"label-width":"1.2rem",disabled:t.$store.state.discount.disable}},[a("div",{staticClass:"m-step-content"},[a("div",{staticClass:"m-step-part"},[a("step",{attrs:{list:t.step}})],1),t._v(" "),a("div",{staticClass:"m-step-part"},[a("h3",{staticClass:"m-step-h3"},[t._v("基本信息")]),t._v(" "),a("el-form-item",{attrs:{label:"活动名称：",prop:"COname"}},[a("el-input",{staticClass:"m-input-l",attrs:{placeholder:""},model:{value:t.$store.state.discount.COname,callback:function(e){t.$set(t.$store.state.discount,"COname",e)},expression:"$store.state.discount.COname"}}),t._v(" "),a("span",{staticClass:"m-label-line"},[t._v("商品范围：")]),t._v(" "),a("span",{staticClass:"m-link m-first",on:{click:function(e){t.showModal(!0)}}},[t._v("选择商品")]),t._v(" "),a("span",{staticClass:"m-remark"},[t._v("(已选中"+t._s(t.$store.state.discount.PRids.length)+"商品,不如则默认全店商品可用)")])],1),t._v(" "),a("el-form-item",{attrs:{label:"使用时间：",prop:"COstart"}},[a("el-date-picker",{staticStyle:{width:"2rem"},attrs:{type:"date",placeholder:"起始时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.$store.state.discount.COstart,callback:function(e){t.$set(t.$store.state.discount,"COstart",e)},expression:"$store.state.discount.COstart"}}),t._v(" "),a("span",{staticClass:"m-date-line"},[t._v("-")]),t._v(" "),a("el-date-picker",{staticStyle:{width:"2rem"},attrs:{type:"date",placeholder:"结束时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.$store.state.discount.COend,callback:function(e){t.$set(t.$store.state.discount,"COend",e)},expression:"$store.state.discount.COend"}})],1)],1),t._v(" "),a("div",{staticClass:"m-step-part"},[a("h3",{staticClass:"m-step-h3 m-flex-between"},[a("span",[t._v("面额信息")])]),t._v(" "),a("el-form-item",{attrs:{label:"优惠金额：",prop:"COamount"}},[a("el-input",{staticClass:"m-input-l",attrs:{type:"number",placeholder:""},model:{value:t.$store.state.discount.COamount,callback:function(e){t.$set(t.$store.state.discount,"COamount",e)},expression:"$store.state.discount.COamount"}}),t._v(" "),a("span",[t._v("  元")])],1),t._v(" "),a("el-form-item",{attrs:{label:"使用门槛：",prop:"COfilter"}},[a("span",[t._v("满  ")]),t._v(" "),a("el-input",{staticClass:"m-input-special",attrs:{type:"number",placeholder:""},model:{value:t.$store.state.discount.COfilter,callback:function(e){t.$set(t.$store.state.discount,"COfilter",e)},expression:"$store.state.discount.COfilter"}}),t._v(" "),a("span",[t._v("  元")])],1),t._v(" "),a("el-form-item",{attrs:{label:"发行量：",prop:"COnumber"}},[a("el-input",{staticClass:"m-input-l ",attrs:{type:"number",placeholder:""},model:{value:t.$store.state.discount.COnumber,callback:function(e){t.$set(t.$store.state.discount,"COnumber",e)},expression:"$store.state.discount.COnumber"}}),t._v(" "),a("span",[t._v("  张")])],1),t._v(" "),a("el-form-item",{attrs:{label:"每人限额：",prop:"COuserfilter"}},[a("el-input",{staticClass:"m-input-l",attrs:{type:"number",placeholder:""},model:{value:t.$store.state.discount.COuserfilter,callback:function(e){t.$set(t.$store.state.discount,"COuserfilter",e)},expression:"$store.state.discount.COuserfilter"}}),t._v(" "),a("span",[t._v("  张")])],1)],1),t._v(" "),a("div",{staticClass:"m-bottom-btn m-flex-center"},[a("span",{staticClass:"m-btn active",on:{click:t.createOne}},[t._v("创建")])])])]),t._v(" "),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.show_modal,expression:"show_modal"}],staticClass:"m-modal"},[a("div",{staticClass:"m-modal-state"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.storeForm,disabled:t.$store.state.discount.disable}},[a("div",{staticClass:"m-modal-head m-flex-between"},[a("span",[t._v("选择商品")]),t._v(" "),a("span",{staticClass:"m-close",on:{click:function(e){t.showModal(!1)}}},[t._v("X")])]),t._v(" "),a("div",{staticClass:"m-modal-content"},[a("div",{staticClass:"m-select-box"},[a("div",{staticClass:"m-left"},[a("el-form-item",{attrs:{label:"商品名称"}},[a("el-input",{staticClass:"m-input-s",attrs:{placeholder:""},model:{value:t.storeForm.name,callback:function(e){t.$set(t.storeForm,"name",e)},expression:"storeForm.name"}})],1)],1),t._v(" "),a("div",{staticClass:"m-right"},[a("el-form-item",[a("el-button",{staticClass:"m-select-btn",attrs:{type:"primary"},on:{click:t.storeSubmit}},[t._v("查询")])],1)],1)]),t._v(" "),a("div",{staticClass:"m-middle",staticStyle:{width:"100%","margin-top":"0.1rem"}},[a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:t.product_data,stripe:""},on:{"selection-change":t.changeFun}},[a("el-table-column",{attrs:{type:"selection",width:"55",prop:"COcheck"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"userId",width:"400",label:"宝贝描述"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"m-production-description"},[a("img",{staticClass:"m-img",staticStyle:{width:"0.5rem",height:"0.5rem"},attrs:{src:e.row.PRimage[0]}}),t._v(" "),a("div",[a("p",[t._v(t._s(e.row.PRname))]),t._v(" "),a("p",[t._v(t._s(e.row.PRid))])])])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"userId",label:"价格"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"PRstock",label:"库存"}})],1)],1),t._v(" "),a("div",{staticClass:"m-page-box"},[a("Pagination",{attrs:{total:t.page_data.total_page},on:{pageChange:t.pageChange}})],1)]),t._v(" "),a("div",{staticClass:"m-modal-foot"},[a("span",{staticClass:"m-btn active",on:{click:t.onSubmit}},[t._v("确认")]),t._v(" "),a("span",{staticClass:"m-btn"},[t._v("取消")])])])],1)])])],1)},staticRenderFns:[]};var p=a("VU/8")(u,m,!1,function(t){a("U2Up")},"data-v-25727ebe",null);e.default=p.exports},U2Up:function(t,e){}});
//# sourceMappingURL=22.fd2c589df6d0ab60ba38.js.map